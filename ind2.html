<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Score Extractor - Simple</title>
    <style>
        /* Basic styling for the page */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        /* Step 1: URL Input */
        .step-section {
            padding: 30px;
            border-bottom: 2px solid #f0f0f0;
        }

        .step-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group input {
            flex: 1;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        /* Status Messages */
        .status-message {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 500;
        }

        .status-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        /* Step 2: Display Teams */
        .teams-display {
            padding: 30px;
        }

        .teams-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        /* Team Cards */
        .team-card {
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .team-card.winner {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .team-card.loser {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .team-badge {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .team-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .team-score {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .team-overs {
            font-size: 16px;
            opacity: 0.9;
        }

        .no-data {
            text-align: center;
            color: #999;
            padding: 40px;
            font-size: 18px;
        }

        .hidden {
            display: none;
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Auto-refresh indicator */
        .auto-refresh-badge {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .teams-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üèè Cricket Score Extractor</h1>
            <p>Extract match scores from cricket scorecard URLs</p>
        </div>

        <!-- STEP 1: URL Input -->
        <div class="step-section">
            <h2>Step 1: Enter Scorecard URL</h2>
            <div class="input-group">
                <input 
                    type="text" 
                    id="urlInput" 
                    placeholder="Enter scorecard URL (e.g., https://cricclubs.com/...)"
                    value="">
                <button class="btn btn-primary" onclick="extractScores()">Extract Scores</button>
            </div>
            <div id="statusMessage"></div>
            <div id="loadingSpinner" class="spinner hidden"></div>
        </div>

        <!-- STEP 2: Display Scores -->
        <div class="teams-display">
            <h2 id="step2Header">Step 2: Match Scores</h2>
            <div id="teamsGrid" class="teams-grid">
                <div class="no-data">
                    Enter a URL and click "Extract Scores" to see the match results
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variable to store the current URL being tracked
        let currentURL = null;
        // Global variable to store the auto-refresh interval
        let refreshInterval = null;

        /**
         * MAIN FUNCTION: extractScores()
         * ===============================
         * Purpose: Fetches the URL and extracts the two team scores
         * 
         * How it works:
         * 1. Gets URL from input field
         * 2. Fetches the HTML content from that URL
         * 3. Parses the HTML to find <li class="win"> and <li class="lose">
         * 4. Extracts team name, score, and overs from each
         * 5. Displays the teams in separate cards
         * 6. Sets up auto-refresh every 30 seconds
         */
        async function extractScores() {
            const url = document.getElementById('urlInput').value.trim();
            
            // Validate URL
            if (!url) {
                showStatus('Please enter a URL', 'error');
                return;
            }

            if (!isValidURL(url)) {
                showStatus('Please enter a valid URL', 'error');
                return;
            }

            // Store the current URL for auto-refresh
            currentURL = url;

            // Clear any existing refresh interval
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }

            // Perform the initial fetch
            await performFetch(url);

            // Set up auto-refresh every 30 seconds (30000 milliseconds)
            refreshInterval = setInterval(async () => {
                console.log('Auto-refreshing scores...');
                await performFetch(currentURL, true); // true means this is an auto-refresh
            }, 30000);

            // Add visual indicator to the header
            const header = document.getElementById('step2Header');
            header.innerHTML = 'Step 2: Match Scores <span class="auto-refresh-badge">üîÑ Auto-updating every 30s</span>';

            showStatus('Scores will auto-update every 30 seconds', 'success');
        }

        /**
         * FUNCTION: performFetch()
         * =========================
         * Purpose: Fetch and display scores from a URL
         * This function is called both manually and by auto-refresh
         * 
         * @param {string} url - The URL to fetch
         * @param {boolean} isAutoRefresh - Whether this is an automatic refresh
         */
        async function performFetch(url, isAutoRefresh = false) {
            // Only show loading spinner for manual fetches
            if (!isAutoRefresh) {
                document.getElementById('loadingSpinner').classList.remove('hidden');
                document.getElementById('teamsGrid').innerHTML = '<div class="no-data">Loading...</div>';
            }

            try {
                // Fetch the URL content
                // Note: This may fail due to CORS. In production, you'd need a proxy server.
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const htmlText = await response.text();
                
                // Parse and display the scores
                parseAndDisplayScores(htmlText);
                
                if (!isAutoRefresh) {
                    showStatus('Scores extracted successfully! Auto-updating every 30 seconds...', 'success');
                } else {
                    // Update status to show last refresh time
                    const now = new Date();
                    const timeString = now.toLocaleTimeString();
                    showStatus(`Last updated: ${timeString} (Auto-refresh active)`, 'success');
                }
            } catch (error) {
                console.error('Fetch error:', error);
                
                // Only show error message for manual fetches
                if (!isAutoRefresh) {
                    showStatus(
                        `Unable to fetch URL. This is likely due to CORS restrictions. The website may be blocking automated requests.`, 
                        'error'
                    );
                    document.getElementById('teamsGrid').innerHTML = '<div class="no-data">Unable to load scores</div>';
                    
                    // Stop auto-refresh if initial fetch fails
                    if (refreshInterval) {
                        clearInterval(refreshInterval);
                        refreshInterval = null;
                    }
                }
            } finally {
                // Hide loading spinner
                if (!isAutoRefresh) {
                    document.getElementById('loadingSpinner').classList.add('hidden');
                }
            }
        }

        /**
         * FUNCTION: parseAndDisplayScores()
         * ==================================
         * Purpose: Parse HTML and extract team information from win/lose elements
         * 
         * What it looks for:
         * - <li class="win"> = Winning team(s) - can be 1 or 2
         * - <li class="lose"> = Losing team(s) - can be 1 or 2
         * 
         * Scenarios handled:
         * - 1 win + 1 lose (normal match)
         * - 2 wins (tie/both teams won)
         * - 2 loses (both teams lost)
         * - 1 win + 0 lose (only winner shown)
         * - 0 win + 1 lose (only loser shown)
         * 
         * Inside each <li>, it extracts:
         * - <span class="teamName"> = Team name
         * - Next <span> = Score
         * - <p style="text-transform: lowercase;"> = Overs
         */
        function parseAndDisplayScores(htmlText) {
            // Create a DOM parser to convert HTML string into DOM elements
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlText, 'text/html');

            // Find ALL winning team elements (could be 0, 1, or 2)
            const winElements = doc.querySelectorAll('li.win');
            // Find ALL losing team elements (could be 0, 1, or 2)
            const loseElements = doc.querySelectorAll('li.lose');

            // Create an array to hold all teams
            const teams = [];

            // Extract data from all win elements
            winElements.forEach((element, index) => {
                const teamData = extractTeamData(element);
                if (teamData) {
                    teamData.status = 'win';
                    teamData.label = winElements.length > 1 ? `WINNER ${index + 1}` : 'WINNER';
                    teams.push(teamData);
                }
            });

            // Extract data from all lose elements
            loseElements.forEach((element, index) => {
                const teamData = extractTeamData(element);
                if (teamData) {
                    teamData.status = 'lose';
                    teamData.label = loseElements.length > 1 ? `TEAM ${index + 1}` : 'RUNNER-UP';
                    teams.push(teamData);
                }
            });

            // Display all teams
            displayTeams(teams);
        }

        /**
         * FUNCTION: extractTeamData()
         * ============================
         * Purpose: Extract team name, score, and overs from an <li> element
         * 
         * @param {Element} element - The <li> element (either class="win" or class="lose")
         * @returns {Object} - Object containing teamName, score, and overs
         */
        function extractTeamData(element) {
            // If element doesn't exist, return null
            if (!element) {
                return null;
            }

            // Find the team name span
            const teamNameSpan = element.querySelector('span.teamName');
            const teamName = teamNameSpan ? teamNameSpan.textContent.trim() : 'Unknown Team';

            // Find all spans inside the element
            const allSpans = element.querySelectorAll('span');
            let score = 'N/A';
            
            // The score is in the span right after the teamName span
            // Loop through spans to find the one after teamName
            for (let i = 0; i < allSpans.length; i++) {
                if (allSpans[i].classList.contains('teamName') && allSpans[i + 1]) {
                    score = allSpans[i + 1].textContent.trim();
                    break;
                }
            }

            // Find the overs paragraph
            const oversP = element.querySelector('p[style*="text-transform: lowercase"]');
            const overs = oversP ? oversP.textContent.trim() : 'N/A';

            return {
                teamName: teamName,
                score: score,
                overs: overs
            };
        }

        /**
         * FUNCTION: displayTeams()
         * =========================
         * Purpose: Display all teams found (can be 1, 2, or more teams)
         * 
         * @param {Array} teams - Array of team objects with status, label, teamName, score, overs
         */
        function displayTeams(teams) {
            const teamsGrid = document.getElementById('teamsGrid');

            // Check if we have any data
            if (!teams || teams.length === 0) {
                teamsGrid.innerHTML = '<div class="no-data">No team data found in the scorecard</div>';
                return;
            }

            // Build the HTML for all team cards
            let html = '';

            teams.forEach(team => {
                // Determine card class based on status
                const cardClass = team.status === 'win' ? 'winner' : 'loser';
                const badge = team.status === 'win' ? 'üèÜ' : '';

                html += `
                    <div class="team-card ${cardClass}">
                        <div class="team-badge">${badge} ${team.label}</div>
                        <div class="team-name">${team.teamName}</div>
                        <div class="team-score">${team.score}</div>
                        <div class="team-overs">${team.overs}</div>
                    </div>
                `;
            });

            // Update the display
            teamsGrid.innerHTML = html;
        }

        /**
         * FUNCTION: showStatus()
         * =======================
         * Purpose: Display status messages to the user
         */
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
            
            // Don't auto-hide messages anymore since we want to show auto-refresh status
            // The status will update with each refresh showing the timestamp
        }

        /**
         * FUNCTION: isValidURL()
         * =======================
         * Purpose: Check if a string is a valid URL
         */
        function isValidURL(string) {
            try {
                new URL(string);
                return true;
            } catch (err) {
                return false;
            }
        }

        /**
         * CLEANUP: Stop auto-refresh when page unloads
         * ==============================================
         * This ensures the interval is cleared when the browser is closed
         * or the page is navigated away from
         */
        window.addEventListener('beforeunload', () => {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        });
    </script>
</body>
</html>
